<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>TribeDB - MySQL分表分库数据中间件 for Node.js</title>
    <link href="http://cdn.bootcss.com/highlight.js/8.1/styles/atelier-forest.light.min.css" rel="stylesheet">
    <link rel='stylesheet' href='style.css'>

  </head>
  <body>
    <h1>TribeDB - 分布式集群储存框架 - Node.js</h1>
    <p>TribeDB 是一个MySQL分表分库数据中间件，实现MySQL数据的分布式集群储存管理。在处理海量数据、高并发访问时，获得更加优越的性能及横向扩展能力。它包含以下主要特性:</p>
    <ul>
      <li>可伸缩、高扩展的架构</li>
      <li>自动路由分库，维护数据库连接池</li>
      <li>支持数据表的“横向”和“纵向”分表</li>
      <li>支持“一主多从”式读写分离</li>
      <li>分布式并行处理，成倍提升性能</li>
      <li>对应用层隐藏数据来源及技术细节</li>
    </ul>
    <p>拥有以上特点意味着，可随时通过增加普通级别数据库服务器的方式，方便地扩展整体系统性能，而无需修改业务层架构和代码。理论上TribeDB的扩展能力上线在于主库单表插入性能和主从数据同步开销。通过合理设计“横向”和“纵向”分表和数据切分粒度，可轻松应对上亿级别的数据量和访问请求。</p>
    <p>本文档包括 TribeDB 详细API说明和对应的最优数据库设计建议。</p>

    <a href="https://github.com/yangjiePro/TribeDB"><img style="position: fixed; top: 0; right: 0; border: 0;" src="fork.png" alt="Fork me on GitHub"></a>

    <div class="example">
      <a name="menu"></a>
      <h3>目录</h3>
      <ul class="menu">
        <li><a href="#example">快速上手</a></li>
        <li><a href="#setup">安装</a>环境与依赖</li>
        <li><a href="#configure">configure()</a>载入或返回配置</li>
        <li><a href="#configure-format">配置文件</a>格式详解</li>
        <li><a href="#query">query()</a>执行sql请求</li>
        <li><a href="#createQuery">createQuery()</a>新建数据操作对象</li>
        <ul>
          <li><a href="#db-table">table()</a>设置要操作的数据表</li>
          <li><a href="#db-columns">columns()</a>查询返回的字段</li>
          <li><a href="#db-data">data()</a>插入或更新的数据</li>
          <li><a href="#db-reset">reset()</a>重置数据操作对象</li>
          <li class="line"></li>
          <li><a href="#db-where">where()</a>查询条件</li>
          <li><a href="#db-or_where">or_where()</a></li>
          <li><a href="#db-where_in">where_in()</a></li>
          <li><a href="#db-where_in">or_where_in()</a></li>
          <li><a href="#db-where_not_in">where_not_in()</a></li>
          <li><a href="#db-or_where_not_in">or_where_not_in()</a></li>
          <li><a href="#db-where_between">where_between()</a>查找区间</li>
          <li><a href="#db-where_not_between">where_not_between()</a></li>
          <li><a href="#db-or_where_between">or_where_between()</a></li>
          <li><a href="#db-or_where_not_between">or_where_not_between()</a></li>
          <li class="line"></li>
          <li><a href="#db-like">like()</a>模糊查找</li>
          <li><a href="#db-or_like">or_like()</a></li>
          <li><a href="#db-not_like">not_like()</a></li>
          <li><a href="#db-or_not_like">or_not_like()</a></li>
          <li class="line"></li>
          <li><a href="#db-order_by">order_by()</a>排序</li>
          <li><a href="#db-group_by">group_by()</a>分组</li>
          <li><a href="#db-group_by">limit()</a>限制或分页</li>
          <li class="line"></li>
          <li><a href="#db-join">join()</a>分表联合请求</li>
          <li class="line"></li>
          <li><a href="#db-insert">insert()</a>数据储存</li>
          <li><a href="#db-delete">delete()</a>数据删除</li>
          <li><a href="#db-update">update()</a>数据更新</li>
          <li><a href="#db-select">select()</a>数据查询</li>
        </ul>
      </ul>
    </div>


    <div class="example">
      <a name="example"></a>
      <h3>快速上手：</h3>
        <pre class="source"><code>
var tribe = require('tribedb');
//载入配置文件，sync选项为true 表示同步读取解析配置文件
tribe.configure('/path/to/tribe.conf',{sync:true});
//通过数据库表名建立查询请求
var db = tribe.createQuery('my_table');
//插入封装
db.data({title:'标题'}).insert(function(err, data){
  console.log(err);
  console.log(data);
});
//查询封装
db.where('title','标题').order_by('time','DESC').limit(1).select(function(err, data){
  console.log(err);
  console.log(data);
});
//不使用封装的操作，直接执行sql
tribe.query('SELECT * FROM user_0 WHERE id=1 LIMIT 1',function(err, data){
  console.log(err);
  console.log(data);
});
      </code></pre>
    </div>
    <p>TribeDB 通过全局唯一的表名，自动连接对应的数据库，并通过分表配置，将操作映射到涉及的分表，同时完成读写分离。
    一切都由 TribeDB 自动完成，业务层不必关心数据的位置。当数据库负载过高需要添加服务器时，只需简单修改配置文件而不必修改业务代码，甚至将整个架构推倒重来。继续阅读本文档详细了解如何使用。</p>


    <div class="example">
      <a name="setup"></a>
      <h3>安装</h3>
      <p>推荐采用 <a href="https://www.npmjs.org/search?q=tribedb" target="_black">NPM</a> 方式安装 TribeDB。也可以 <a href="https://github.com/yangjiePro/TribeDB/archive/master.zip" target="_black">下载源码</a>，但需要自己处理依赖。</p>
      <pre class="source"><code>$ npm install tribedb

#tribedb@0.1.1 node_modules\tribedb
#└── mysql@2.5.2 (require-all@0.0.8, bignumber.js@1.4.1, readable-stream@1.1.13)</code></pre>
    </div>

    <div class="example">
      <a name="configure"></a>
      <h3>configure([src], [opt], [callback])　载入或返回配置。</h3>
      <div class="param">
        <p><em>src</em>=<var>[path]</var>：从文件路径读取配置。</p>
        <p><em>src</em>=<var>[url]</var>：从url读取配置。</p>
        <p><em>src</em>=<var>[string]</var>：载入配置文件正文。</p>
        <p><em>src</em>=<var>undefined</var>：表示返回从本地读取或从网络下载的配置文件正文。</p>
      </div>
      <div class="param">
        <p><em>opt</em><var>object</var>：配置选项（可省略）</p>
        <p><em>opt.sync</em><var>boolen</var>：是否以同步方式读取解析配置文件。（注意：url加载配置时始终为异步方式）。</p>
      </div>
      <div class="param">
        <p><em>callback</em><var>function</var>：配置文件加载并解析完成后的回调</p>
      </div>
      <p>一般情况下，在Node.js程序启动时载入配置。当异步载入配置时，若立即调用数据操作函数将返回配置错误信息，需要等待配置加载并解析完成。
      </p>
    </div>

    <div class="example">
      <a name="configure-format"></a>
      <h3>配置文件格式详解</h3>
      <pre class="source"><code>#示例配置文件
[system]

read_only   = no #yes/no
master_only = no #yes/no

[database]

master:
db1 = 127.0.0.1, 3306, root, password, my_db1
db2 = 127.0.0.1, 3306, root, password, my_db2

slave:
db1 = 127.0.0.1, , root, , my_db11
db1 = 127.0.0.2, , root, , my_db12

[table]

#分表分库
db1:
user = 10w, id
post = 10w, id

# 不分表但分库
db2:
mytable1; mytable2; mytable3; mytable4;
      </code></pre>
    </div>























 <div class="footer">
   <span>@ TribeDB - 2015</span>
   <span>作者：<a href="http://jojoin.com/user/1">杨捷</a></span>
   <span>Email：<a href=mailto:yangjie@jojoin.com>yangjie@jojoin.com</a></span>
   <span>Github：<a href="https://github.com/yangjiePro/TribeDB">https://github.com/yangjiePro/TribeDB</a></span>
 </div>


<script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/highlight.js/8.1/highlight.min.js"></script>
<script src="http://cdn.bootcss.com/highlight.js/8.1/languages/python.min.js"></script>

<script type="text/javascript">

  //hljs.configure({useBR: true});

  $('code').each(function(i, block) {
    hljs.highlightBlock(block);
  });


</script>


  </body>
</html>

